(function(t,e,i){"use strict";var s=this.Rebar=t.Rebar={},n=function(t){var i=this,s=function(){i.apply(this,arguments)};return s.prototype=e.extend(i.prototype,t),s},r=s.Application=function(t){return r.instance&&t&&!t._bypassSingleton?r.instance:(t&&t.logLevel?c.setLogLevel(t.logLevel):c.setLogLevel(c.Levels.None),r.instance=this,this.options=t?t:{},this.state=r.States.Initialized,i(window).on("beforeunload unload",i.proxy(function(){this.state=r.States.Shutdown},this)),void 0)};r.States={Default:0,Initialized:1,Faulted:2,Started:3,Shutdown:4},r.prototype=Object.create(t.Events,{_state:{value:r.States.Default,writable:!0},state:{get:function(){return this._state},set:function(t){this._state!==t&&(this._state=t,this._state===r.States.Initialized&&(this.createModel(this.options.modelOptions),this.createView(this.options.viewOptions),this.createRouter(this.options.routerOptions),this.initialize(this.options)),this.trigger("applicationStateDidChange",this.state))}},initialize:{value:function(){},writable:!0},createModel:{value:function(i){this.model||(this.model=new t.Model(e.extend({},i)))},writable:!0},createView:{value:function(t){this.view||(this.view=new a(e.extend({el:i("#application")},t)))},writable:!0},createRouter:{value:function(t){this.router||(this.router=new l(e.extend({landing:this.options.landing?this.options.landing:"",dispatcher:this},t)),this.router.on("routeDidChange",function(t){this.trigger("routeDidChange",t)},this))},writable:!0},startup:{value:function(){if(this.options.bootstrap){var s=this;i.ajax({cache:!1,dataType:"json",type:"GET",url:this.options.bootstrap,success:function(i){e.isEmpty(i)?(s.error="Error: Bootstrap load error.",s.state=r.States.Faulted):(s.model.set("bootstrap",i),t.history.start({pushState:!1}),s.state=r.States.Started)},error:function(t){s.error=t,s.state=r.States.Faulted}})}else t.history.start({pushState:!1}),this.state=r.States.Started}}}),r.extend=n,s.PersistenceModel=t.Model.extend({getStoargeId:function(){var t="pm";return this.urlRoot&&(t=t+"_"+this.url().split("/")[0]),t},set:function(i,s,n){"url"===i?this.urlRoot=s:e.isObject(i)&&e.has(i,"url")&&!e.isUndefined(i.url)&&(this.urlRoot=i.url),t.Model.prototype.set.call(this,i,s,n)},sync:function(t,i,s){if("read"===t)this.pullLocalStore(i,s);else if("create"===t)localStorage.setItem(i.getStoargeId(),JSON.stringify(e.omit(i.attributes,["url","urlRoot"])));else if("update"===t)this.pullLocalStore(i,s);else{if("patch"===t)throw"'patch' not implemented yet";if("delete"===t)throw"'delete' not implemented yet"}},pullLocalStore:function(t,e){if(localStorage){var i=localStorage.getItem(t.getStoargeId());if(null!==i){var s=JSON.parse(i);t.set(s),e.success&&e.success(t,s,e),t.trigger("sync",t,s,e)}}else{var n="Error: 'localStorage' is not supported";e.error&&e.error(t,n,e),t.trigger("sync",t,n,e)}}});var o=s.View=function(i){t.View.call(this,i),e.extend(this,e.pick(this.options,["render","destroy","transitionIn","transitionOut"]))};o.prototype=Object.create(t.View.prototype,{destroy:{value:function(){this._isDestroyed||(this._isDestroyed=!0,this.trigger("viewDidDestroy",this),this.off(),this.$el.off(),this.remove())},writable:!0},render:{value:function(){},writable:!0},transitionIn:{value:function(t,i){e.isFunction(t)&&t.call(i?i:this)},writable:!0},transitionOut:{value:function(t,i){e.isFunction(t)&&t.call(i?i:this)},writable:!0}}),o.extend=t.View.extend;var a=s.CompositeView=function(t){this.subViews=[],o.call(this,t)};a.prototype=Object.create(o.prototype,{addSubView:{value:function(t){t.on("viewDidDestroy",function(t){this.removeSubView(t)},this),this.subViews.push(t);var e=this;t.render(function(i){var s=i?i:t.el;e.$el.append(s)})},writable:!0},addSubViews:{value:function(t){e.each(t,function(t){this.addSubView(t)},this)},writable:!0},removeSubView:{value:function(t){t.cid||(t=e.where(this.subViews,{cid:t})[0]),this.destroySubView(t),this.subViews=e.reject(this.subViews,function(e){return e.cid===t.cid})},writable:!0},removeAllSubViews:{value:function(){e.each(this.subViews,function(t){this.removeSubView(t)},this)},writable:!0},destroy:{value:function(){this.subViews.length>0&&e.each(this.subViews,function(t){this.destroySubView(t)},this),this.subViews=[],o.prototype.destroy.call(this)},writable:!0},destroySubView:{value:function(t){e.isFunction(t.destroy)?t.destroy(!0):e.isUndefined(t.cid)||o.prototype.destroy.call(t)},writable:!0}}),a.extend=o.extend;var h=s.Mediator=function(t){t&&(this.options=t,e.extend(this,e.pick(this.options,["initialize","handle","view"])),this.options.events&&this.processEvents(this.options.events),this.view&&this.options.viewEvents&&this.processViewEvents(this.options.viewEvents)),this._views=[],this.initialize(t)};h.prototype=Object.create(t.Events,{_views:{value:void 0,writable:!0,configurable:!1},view:{value:void 0,writable:!0,configurable:!1},initialize:{value:function(){},writable:!0},addView:{value:function(t,i){var s;s=i?i.split(" "):["all"],e.each(s,function(e){t.on(e,function(i){this.handle(e,t,i)},this)},this),this._views.push(t)},writable:!0},removeView:{value:function(t){t.off(null,this.handle,this),this._views=e.reject(this._views,function(e){return e.cid===t.cid?!0:!1},this)},writable:!0},hasView:{value:function(t){return e.where(this._views,{cid:t.cid})[0]},writable:!0},getView:{value:function(t){return e.filter(this._views,function(i){var s=e.keys(t)[0],n=e.values(t)[0];return i[s]&&i[s]===n?!0:i.options&&i.options[s]&&i.options[s]===n?!0:!1})[0]},writable:!0},getViewByName:{value:function(t){var i=this.getView({name:t});return e.isUndefined(i)&&console.warn("Property 'name' was not found on any views."),i},writable:!0},destroy:{value:function(){e.each(this._views,function(t){this.removeView(t)},this)},writable:!0},handle:{value:function(){},writable:!0},processEvents:{value:function(t){for(var i in t){var s=t[i];e.isObject(s)?this.assignCallbackToDispatcher(i,s.callback,s.dispatcher):this.assignCallbackToDispatcher(i,s,this.options.dispatcher)}}},processViewEvents:{value:function(t){var i=t.split(" ");e.each(i,function(t){this.view.on(""+t,function(e){this.handle(t,this.view,e)},this)},this)}},assignCallbackToDispatcher:{value:function(t,e,i){this[e]?i.on(t,this[e],this):this.options[e]?i.on(t,this.options[e],this):console.error("Error: No method '"+e+"' found on mediator")}}}),h.extend=n;var u=s.Controller=function(){};u.prototype=Object.create(t.Events,{});var l=s.DependencyRouter=function(i){if(!e.isUndefined(i)&&(e.isUndefined(i.landing)||(this.landing=i.landing),!e.isUndefined(i.staticRoutes)))for(var s in i.staticRoutes)this.setStaticRoute(s,i.staticRoutes[s]);t.Router.call(this,i)};l.prototype=Object.create(t.Router.prototype,{landing:{value:"",writable:!0},routes:{value:{"":"handleNoHash","*splat":"handleAll"},writable:!0},staticRoutes:{value:{},writable:!0},handleNoHash:{value:function(){this.handleAll(this.landing+t.history.location.search)},writable:!0},handleAll:{value:function(i){var s=e.isUndefined(i)?t.history.getFragment():i;for(var n in this.staticRoutes)if(n===s)return this.staticRoutes[n](),void 0;var r=this.parseRoute(s);this.trigger("routeDidChange",r),this.pRoute=r},writable:!0},parseRoute:{value:function(t){var e,i,s=t.split("/"),n=s[s.length-1].split("?"),r=n[0].split("#"),o=r[0],a=r[1],h=this.parseRouteData(n[1]);if(2===s.length&&(i=s[0]),3===s.length&&(e=s[0],i=s[1]),s.length>3){var u=s.length-2;e="";for(var l=0;u>l;l++)e+=s[l]+(u-1>l?"/":"");i=s[s.length-2]}return{directory:e,file:i,view:""!==o?o:void 0,data:h,anchor:a}},writable:!0},parseRouteData:{value:function(t){if(e.isUndefined(t))return void 0;var i=t.split("&"),s={};return e.each(i,function(t){var e=t.split("=");s[e[0]]=e[1]}),s},writable:!0},getFileLocation:{value:function(t){return e.isUndefined(t.directory)||""===t.directory?e.isUndefined(t.file)||""===t.file?"":t.file:t.directory+"/"+t.file},writable:!0},setStaticRoute:{value:function(t,e){this.staticRoutes[t]=e},writable:!0},setStaticRoutes:{value:function(t){for(var e in t)this.staticRoutes[e]=t[e]},writable:!0}}),l.extend=t.Router.extend;var c=s.Logger=function(){function t(t){r&&o>=c.Levels.Info&&n.console.log(t)}function e(t){r&&o>=c.Levels.Info&&n.console.warn(t)}function i(t){r&&o>=c.Levels.Error&&n.console.error(t)}function s(t){return o=t}var n=this,r=void 0!==typeof console,o=0;return{log:t,warn:e,error:i,setLogLevel:s,Levels:{None:0,Error:10,Info:20,Verbose:30}}}.call(this)}).call(this,Backbone,_,$);