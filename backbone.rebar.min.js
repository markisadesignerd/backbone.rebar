/**
 * Backbone.Rebar v0.4.0
 * Adding a little bit more reinforcement to an already spectacular framework.
 * https://github.com/mcgaryes/rebar
 */
(function(t,e,i){"use strict";var s=this.Rebar=t.Rebar={},n=function(t){var i=this,s=function(){i.apply(this,arguments)};return s.prototype=e.extend(i.prototype,t),s},o=s.Application=function(t){return o.instance&&t&&!t._bypassSingleton?o.instance:(t&&t.logLevel?h.setLogLevel(t.logLevel):h.setLogLevel(h.Levels.None),o.instance=this,this.options=t?t:{},this.state=o.States.Initialized,i(window).on("beforeunload unload",i.proxy(function(){this.state=o.States.Shutdown},this)),void 0)};o.States={Default:0,Initialized:1,Faulted:2,Started:3,Shutdown:4},o.prototype=Object.create(t.Events,{_state:{value:o.States.Default,writable:!0},state:{get:function(){return this._state},set:function(t){this._state!==t&&(this._state=t,this._state===o.States.Initialized&&(this.createModel(),this.createView(),this.createRouter(),this.initialize(this.options)),this.trigger("applicationStateDidChange",this.state))}},initialize:{value:function(){},writable:!0},createModel:{value:function(){this.model||(this.model=new t.Model)},writable:!0},createView:{value:function(){this.view||(this.view=new a({el:i("#application")}))},writable:!0},createRouter:{value:function(){this.router||(this.router=new c({landing:this.options.landing?this.options.landing:"",dispatcher:this}),this.router.on("routeDidChange",function(t){this.trigger("routeDidChange",t)},this))},writable:!0},startup:{value:function(){if(this.options.bootstrap){var s=this;i.ajax({cache:!1,dataType:"json",type:"GET",url:this.options.bootstrap,success:function(i){e.isEmpty(i)?(s.error="Error: Bootstrap load error.",s.state=o.States.Faulted):(s.model.set("bootstrap",i),t.history.start({pushState:!1}),s.state=o.States.Started)},error:function(t){s.error=t,s.state=o.States.Faulted}})}else t.history.start({pushState:!1}),this.state=o.States.Started}}}),o.extend=n,s.PersistenceModel=t.Model.extend({getStoargeId:function(){var t="pm";return this.urlRoot&&(t=t+"_"+this.url().split("/")[0]),t},set:function(i,s,n){"url"===i?this.urlRoot=s:e.isObject(i)&&e.has(i,"url")&&!e.isUndefined(i.url)&&(this.urlRoot=i.url),t.Model.prototype.set.call(this,i,s,n)},sync:function(t,i,s){if("read"===t)this.pullLocalStore(i,s);else if("create"===t)localStorage.setItem(i.getStoargeId(),JSON.stringify(e.omit(i.attributes,["url","urlRoot"])));else if("update"===t)this.pullLocalStore(i,s);else{if("patch"===t)throw"'patch' not implemented yet";if("delete"===t)throw"'delete' not implemented yet"}},pullLocalStore:function(t,e){if(localStorage){var i=localStorage.getItem(t.getStoargeId());if(null!==i){var s=JSON.parse(i);t.set(s),e.success&&e.success(t,s,e),t.trigger("sync",t,s,e)}}else{var n="Error: 'localStorage' is not supported";e.error&&e.error(t,n,e),t.trigger("sync",t,n,e)}}});var r=s.View=function(i){t.View.call(this,i),e.extend(this,e.pick(this.options,["render","destroy","transitionIn","transitionOut"]))};r.prototype=Object.create(t.View.prototype,{destroy:{value:function(){this._isDestroyed||(this._isDestroyed=!0,this.trigger("viewDidDestroy",this),this.off(),this.$el.off(),this.remove())},writable:!0},render:{value:function(){},writable:!0},transitionIn:{value:function(t,i){e.isFunction(t)&&t.call(i?i:this)},writable:!0},transitionOut:{value:function(t,i){e.isFunction(t)&&t.call(i?i:this)},writable:!0}}),r.extend=t.View.extend;var a=s.CompositeView=function(t){this.subViews=[],r.call(this,t)};a.prototype=Object.create(r.prototype,{addSubView:{value:function(t){t.on("viewDidDestroy",function(t){this.removeSubView(t)},this),this.subViews.push(t);var e=this;t.render(function(i){var s=i?i:t.el;e.$el.append(s)})},writable:!0},addSubViews:{value:function(t){e.each(t,function(t){this.addSubView(t)},this)},writable:!0},removeSubView:{value:function(t){t.cid||(t=e.where(this.subViews,{cid:t})[0]),this.destroySubView(t),this.subViews=e.reject(this.subViews,function(e){return e.cid===t.cid})},writable:!0},removeAllSubViews:{value:function(){e.each(this.subViews,function(t){this.removeSubView(t)},this)},writable:!0},destroy:{value:function(){this.subViews.length>0&&e.each(this.subViews,function(t){this.destroySubView(t)},this),this.subViews=[],r.prototype.destroy.call(this)},writable:!0},destroySubView:{value:function(t){e.isFunction(t.destroy)?t.destroy(!0):e.isUndefined(t.cid)||r.prototype.destroy.call(t)},writable:!0}}),a.extend=r.extend;var l=s.Mediator=function(t){t&&(this.options=t,e.extend(this,e.pick(this.options,["initialize","handle","view"])),this.options.events&&this.processEvents(this.options.events),this.view&&this.options.viewEvents&&this.processViewEvents(this.options.viewEvents)),this._views=[],this.initialize(t)};l.prototype=Object.create(t.Events,{_views:{value:void 0,writable:!0,configurable:!1},view:{value:void 0,writable:!0,configurable:!1},initialize:{value:function(){},writable:!0},addView:{value:function(t,i){var s;s=i?i.split(" "):["all"],e.each(s,function(e){t.on(e,function(i){this.handle(e,t,i)},this)},this),this._views.push(t)},writable:!0},removeView:{value:function(t){t.off(null,this.handle,this),this._views=e.reject(this._views,function(e){return e.cid===t.cid?!0:!1},this)},writable:!0},hasView:{value:function(t){return e.where(this._views,{cid:t.cid})[0]},writable:!0},getView:{value:function(t){return e.filter(this._views,function(i){var s=e.keys(t)[0],n=e.values(t)[0];return i[s]&&i[s]===n?!0:i.options&&i.options[s]&&i.options[s]===n?!0:!1})[0]},writable:!0},getViewByName:{value:function(t){var i=this.getView({name:t});return e.isUndefined(i)&&console.warn("Property 'name' was not found on any views."),i},writable:!0},destroy:{value:function(){e.each(this._views,function(t){this.removeView(t)},this)},writable:!0},handle:{value:function(){},writable:!0},processEvents:{value:function(t){for(var i in t){var s=t[i];e.isObject(s)?this.assignCallbackToDispatcher(i,s.callback,s.dispatcher):this.assignCallbackToDispatcher(i,s,this.options.dispatcher)}}},processViewEvents:{value:function(t){var i=t.split(" ");e.each(i,function(t){this.view.on(""+t,function(e){this.handle(t,this.view,e)},this)},this)}},assignCallbackToDispatcher:{value:function(t,e,i){this[e]?i.on(t,this[e],this):this.options[e]?i.on(t,this.options[e],this):console.error("Error: No method '"+e+"' found on mediator")}}}),l.extend=n;var u=s.Controller=function(){};u.prototype=Object.create(t.Events,{});var c=s.DependencyRouter=t.Router.extend({landing:"",routes:{"":"handleNoHash","*splat":"handleAll"},staticRoutes:{},initialize:function(t){e.isUndefined(t)||e.isUndefined(t.landing)||(this.landing=t.landing)},handleNoHash:function(){this.handleAll(this.landing+t.history.location.search)},handleAll:function(i){var s=e.isUndefined(i)?t.history.getFragment():i;for(var n in this.staticRoutes)if(n===s)return this.staticRoutes[n](),void 0;var o=this.parseRoute(s);this.trigger("routeDidChange",o),this.pRoute=o},parseRoute:function(t){var e,i,s=t.split("/"),n=s[s.length-1].split("?"),o=n[0].split("#"),r=o[0],a=o[1],l=this.parseRouteData(n[1]);if(2===s.length&&(i=s[0]),3===s.length&&(e=s[0],i=s[1]),s.length>3){var u=s.length-2;e="";for(var c=0;u>c;c++)e+=s[c]+(u-1>c?"/":"");i=s[s.length-2]}return{directory:e,file:i,view:""!==r?r:void 0,data:l,anchor:a}},parseRouteData:function(t){if(e.isUndefined(t))return void 0;var i=t.split("&"),s={};return e.each(i,function(t){var e=t.split("=");s[e[0]]=e[1]}),s},getFileLocation:function(t){return e.isUndefined(t.directory)||""===t.directory?e.isUndefined(t.file)||""===t.file?"":t.file:t.directory+"/"+t.file},setStaticRoute:function(t,e){this.staticRoutes[t]=e},setStaticRoutes:function(t){for(var e in t)this.staticRoutes[e]=t[e]}}),h=s.Logger=function(){function t(t){o&&r>=h.Levels.Info&&n.console.log(t)}function e(t){o&&r>=h.Levels.Info&&n.console.warn(t)}function i(t){o&&r>=h.Levels.Error&&n.console.error(t)}function s(t){return r=t}var n=this,o=void 0!==typeof console,r=0;return{log:t,warn:e,error:i,setLogLevel:s,Levels:{None:0,Error:10,Info:20,Verbose:30}}}.call(this)}).call(this,Backbone,_,$);