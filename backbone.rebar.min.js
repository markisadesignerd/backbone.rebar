(function(e,t,n){"use strict";var r=e.Rebar={},i=function(e){var n=this,r=function(){n.apply(this,arguments)};return r.prototype=t.extend(n.prototype,e),r},s=r.Services={getServices:function(){return[{id:"bootstrap",endpoint:"assets/data/bootstrap_data.json"}]},getServiceEndpointById:function(e){var n;return t.each(this.getServices(),function(t){t.id===e&&(n="/"+t.endpoint)}),n},request:function(e,r,i){var s=this.parseOptions(r),o=s.id,u=s.error,a=s.success,f=s.data,l=this,c=s.url,h={};h.url=s.url?s.url:s.id?this.getServiceEndpointById(o):undefined,t.isUndefined(f)||(h.data=f),h.success=function(e){t.isEmpty(e)?l.handleError(i):l.handleSuccess(i,a,e)},h.error=function(e){l.handleError(i,u,e)},h.cache=!1,h.dataType="json",h.type=e,n.ajax(h)},parseOptions:function(e){return{id:e.id?e.id:undefined,error:e.error?e.error:function(){},success:e.success?e.success:function(){},data:e.data?e.data:undefined,url:e.url?e.url:undefined}},parseError:function(e){var n={};return t.isUndefined(e)||t.isEmpty(e)||t.isNull(e)?(n.code=204,n.message="No Content"):(n.code=e.status,n.message=e.statusText),n.originalError=e,n},handleSuccess:function(e,t,n){t.call(e,n)},handleError:function(e,t,n){t.call(e,this.parseError(n))},get:function(e,t){this.request("GET",e,t)},post:function(e,t){this.request("POST",e,t)},put:function(e,t){this.request("PUT",e,t)},"delete":function(e,t){this.request("DELETE",e,t)}},o=r.Application=function(e){if(o.instance)return o.instance;o.instance=this,this.options=e,this.controller=new c;var r=this.options.dependencyRouting;if(t.isUndefined(r)||t.isBoolean(r)&&r)this.router=new h({landing:e.landing?e.landing:"",controller:this.controller});this.model=new u,this.view=new l({el:n("#application")})};o.prototype=Object.create({},{controller:{value:undefined,writable:!0},model:{value:undefined,writable:!0},view:{value:undefined,writable:!0},router:{value:undefined,writable:!0},services:{value:t.clone(s),writable:!1},start:{value:function(e,t){this.options.bootstrap?this.services.get({url:this.options.bootstrap,success:function(n){this.model.set("bootstrap",n),this.build(e,t)},error:function(e){console.log(e)}},this):this.build(e,t)}},build:{value:function(n,r){e.history.start({pushState:!1}),t.isFunction(n)&&(r?n.call(r):n())}}});var u=r.PersistenceModel=e.Model.extend({getStoargeId:function(){var e="pm";return this.url&&(e=e+"_"+this.url),e},sync:function(e,t,n){if(e==="read")if(localStorage){var r=localStorage.getItem(t.getStoargeId());if(r!==null){var i=JSON.parse(r);t.set(i),n.success&&n.success(t,i,n),t.trigger("sync",t,i,n)}}else{var s="Error: 'localStorage' is not supported";n.error&&n.error(t,s,n),t.trigger("sync",t,s,n)}else if(e==="create")localStorage.setItem(t.getStoargeId(),JSON.stringify(t.attributes));else{if(e==="update")throw"'update' not handled yet";if(e==="patch")throw"'patch' not handled yet";if(e==="delete")throw"'delete' not handled yet"}}}),a=r.Mediator=function(){};a.prototype={},a.extend=i;var f=r.View=e.View.extend({initialize:function(){t.extend(this,t.pick(this.options,["render","destroy","transitionIn","transitionOut"]))},destroy:function(e){this.off(),this.$el.off(),this.remove()},render:function(e){},transitionIn:function(e,n){t.isFunction(e)&&e.call(n?n:this)},transitionOut:function(e,n){t.isFunction(e)&&e.call(n?n:this)}}),l=r.CompositeView=e.Rebar.View.extend({initialize:function(){this.subViews=[],t.extend(this,t.pick(this.options,["addSubView","removeSubView","destroy"])),f.prototype.initialize.call(this)},addSubView:function(e){if(!t.isFunction(e.destroy)){console.log("could not add view because it does not extend Rebar.View");return}this.subViews.push(e),e.parent=this;var n=this;e.render(function(e){n.$el.append(e)})},addSubViews:function(e){t.each(e,function(e){this.addSubView(e)},this)},removeSubView:function(e){e.cid||(e=t.where(this.subViews,{cid:e})),e.destroy(!0),this.subViews=t.reject(this.subViews,function(t){return t.cid===e.cid})},removeAllSubViews:function(){t.each(this.subViews,function(e){this.removeSubView(e)},this)},destroy:function(e){if(!t.isUndefined(this.parent)&&!t.isBoolean(e))return this.parent.removeSubView(this),!1;this.subViews.length>0&&t.each(this.subViews,function(e){e.destroy()}),this.subViews=[],f.prototype.destroy.call(this)}}),c=r.Controller=function(){};c.prototype=Object.create(e.Events),c.extend=i;var h=r.DependencyRouter=e.Router.extend({landing:"",routes:{"":"handleNoHash","*splat":"handleAll"},staticRoutes:{},initialize:function(e){t.isUndefined(e)||(t.isUndefined(e.landing)||(this.landing=e.landing),t.isUndefined(e.controller)||(this.controller=e.controller))},handleNoHash:function(){this.handleAll(this.landing+e.history.location.search)},handleAll:function(n){var r=t.isUndefined(n)?e.history.getFragment():n;for(var i in this.staticRoutes)if(i===r){this.staticRoutes[i]();return}var s=this.parseRoute(r),o=this,u=this.getFileLocation(s);this.controller.trigger("routeDidChange",s),this.pRoute=s},parseRoute:function(e){var t=e.split("/"),n,r,i=t[t.length-1].split("?"),s=i[0].split("#"),o=s[0],u=s[1],a=this.parseRouteData(i[1]);t.length===2&&(r=t[0]),t.length===3&&(n=t[0],r=t[1]);if(t.length>3){var f=t.length-2;n="";for(var l=0;l<f;l++)n+=t[l]+(l<f-1?"/":"");r=t[t.length-2]}return{directory:n,file:r,view:o!==""?o:undefined,data:a,anchor:u}},parseRouteData:function(e){if(t.isUndefined(e))return undefined;var n=e.split("&"),r={};return t.each(n,function(e){var t=e.split("=");r[t[0]]=t[1]}),r},getFileLocation:function(e){return t.isUndefined(e.directory)||e.directory===""?t.isUndefined(e.file)||e.file===""?"":e.file:e.directory+"/"+e.file},setStaticRoute:function(e,t){this.staticRoutes[e]=t},setStaticRoutes:function(e){for(var t in e)this.staticRoutes[t]=e[t]},handleModuleLoadError:function(){console.log("error")}})}).call(this,Backbone,_,$);